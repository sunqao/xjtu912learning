# 数据结构（10）：图的应用 - 关键路径

## **AOE网络：**

即边表示活动的网，`AOE`网络是一个带权的有向无环图，其中顶点表示事件，弧表示活动，弧上的权值表示活动持续的时间，比如下图的一个`AOE`网络：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/Screenshot_2024-03-13-18-29-10-165_com.jideos.jno.png" alt="Screenshot_2024-03-13-18-29-10-165_com.jideos.jno" style="zoom:50%;" />

需要注意的是，图中的每一个顶点事件都表示它之前的活动已经完成，比如顶点事件`5`开始的时候表示指向它的两条边的活动都已经完成了

## **AOE网络的源点和汇点：**

入度为`0`的点为源点，出度为`0`的点为汇点，这两个点可以简单看作工程中的开始点和结束点，如下图的红色的顶点：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/Screenshot_2024-03-13-18-33-38-875_com.jideos.jno.png" alt="Screenshot_2024-03-13-18-33-38-875_com.jideos.jno" style="zoom:50%;" />

## **关键路径：**

`AOE`网中的有些活动是可以并行进行的（如`a1, a2, a3`），所以完成工程的最短时间是从源点到汇点的最长路径的长度。路径长度最长的路径就叫做**关键路径**（Critical Path）。如下图中红色顶点和有向边构成的就是一条关键路径，关键路径的长度就是完成活动（`a1, a4, a9, a10`的时间总和：18：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/Screenshot_2024-03-13-18-40-54-171_com.jideos.jno.png" alt="Screenshot_2024-03-13-18-40-54-171_com.jideos.jno" style="zoom:50%;" />

## **事件最早开始时间：**

时间最早发生时间就是从源点到这个事件顶点**最长路径**上的活动之和，如下图中事件`5`的最早开始时间就是`7`，事件`6`的最早开始时间就是`7`：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/Screenshot_2024-03-13-18-54-09-119_com.jideos.jno.png" alt="Screenshot_2024-03-13-18-54-09-119_com.jideos.jno" style="zoom:50%;" />

为什么这里是最长路径呢，因为由于`AOE`网络的定义，事件`5`开始就意味着活动`a4, a5`已经完成了，要保证这两个活动都完成时间肯定是取大，不能再早了，再早活动`a4`就不能完成了

## **事件最晚开始时间：**

每个顶点事件的最晚开始时间，如果超出了这个时间则工期会延期，计算方式如下：

**事件的最晚开始时间 = 关键路径的长度 - 该事件到汇点的最长路径长度**

我们以下图中的事件`6`为例来说明为什么它的最晚开始的时间是这样计算的；

首先从源点到汇点的关键路径的长度是从源点到汇点最长的路径长度，再加上活动是可以并行进行的，所以最长的路径可以保证`AOE`网络中的所有的活动都可以完成，这个长度也就是**工期**

事件`6`的最晚开始时间就是`18 - 8 = 10`，假如这个时间不是最晚的，`6`再晚一点开始比如`=11`开始，如下图中的红色所示，是`6`开始的时候进度，经过一个时间单位`1`（蓝色），活动`a8`完成，但是此时`a11`不能并行进行，必须等待活动`a9`完成，也就是紫色部分，活动`a9`完成之后活动`a10`就只剩下黄色的进度了，活动`a10`完成之后也就是工期结束，但此时由于`a11`的等待，导致此时`a11`延期个3时间单位，因此事件`6`的最晚开始事件不能晚于`10`，否则后序会存在时间等待导致延期：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/Screenshot_2024-03-13-19-21-28-908_com.jideos.jno.png" alt="Screenshot_2024-03-13-19-21-28-908_com.jideos.jno" style="zoom:50%;" />

## 活动最早开始时间：

活动的最早开始时间就是活动箭头起点事件的最早开始时间，如上图所示活动`a8`的最早开始时间就是`10`

## 活动最晚开始时间：

活动的最晚开始时间就是活动箭头起点事件的最晚开始时间，如上图所示活动`a9`的最早开始时间就是`10`

## 求最长路径的算法：

不管怎么样，不管求什么东西，我们总是得知道一个点到另一个点的最长路径，这里介绍两种求最长路径的方式

### 将边的权值取负

将边的权值全部取反，用`Floyd, SPFA, bellman - Ford`算法求，这些算法求的是负数的最小值，我们结果取反就是正数的最大值了，注意由于含有负边不能用`Dijkstra`算法求解，这里不再赘述

### 拓扑序 + DP

这里用DP的思想来求，分析仍按照集合论的角度分析，不熟悉的看下面文章：

[算法基础（三十二）：用01背包为例来分析动态规划 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/659135617)

**状态表示：**

一个一维变量：`f[i]`

**状态表示的集合：**

`f[i]`对应的集合是从源点出发到点`i`的所有路径长度构成的集合

**状态表示的集合属性：**

集合的最大值

**集合划分：**

从源点到顶点`i`的路径可以按照能直接到达点`i`的顶点进行划分，假设有点`a, b, c`直接指向`i`，即有边`a -> i, b -> i, c -> i`，那么集合中的元素（路径）可以根据最后一个边的起点是哪一个进行划分，如下图所示集合可以划分为三个子集：

<img src="C:\Users\78492\Documents\Tencent Files\784928161\FileRecv\MobileFile\Screenshot_2024-03-13-21-10-44-442_com.jideos.jno.png" alt="Screenshot_2024-03-13-21-10-44-442_com.jideos.jno" style="zoom: 50%;" />

**递推关系：**

`f[i]`是集合的最大值，那么显然是三个子集的最大值然后取大，对于`a -> i`对应的这个子集，集合中的元素路径的最后一个边始终是`a -> i`，要想最大，那么就是从源点到`a`的路径最大，然后加上`w(a -> i)`，即`f[a] + w(a -> i)`，同理另外两个子集的最大值也是这样分析，所以有递推公式：

`f[i] = max(f[a] + w(a -> i), f[b] + w(b -> i), f[c] + w(c -> i))` 

归纳就是：`f[i]  = max(f[k] + w(k -> i))`, 其中`k`满足顶点`k`可以直接到达点`i`，即存在边`k -> i`

由于是按照拓扑序进行递推，我们已经求出了`f[k]`，因此`f[i]`也就顺利求出来了

**时间复杂度：**

每个点和边遍历一次，因此时间复杂度就是`O(m + n)`，线性复杂度
