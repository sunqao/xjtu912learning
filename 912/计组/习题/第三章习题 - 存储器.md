# 第三章习题 - 存储器

## 3.5

![image-20240825110109164](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240825110109164.png)

**（1）**

存取周期和存取时间都是存储器存储速度的概念

存取时间是存储器的访问时间，也就是启动一次存储器读写到完成操作的时间

存取周期是存储器完成一个完整的读写所需要的时间，包括读写时间（存取时间）和后面的电路恢复的时间，是一个更加完整的概念，其时间略大于存取时间

**（2）**

存储器带宽是指单位时间内从存储器进出信息的最大数量，其计算方式是1s中所能够交换的最大信息量

也就是先计算1s有多少个周期，然后这些周期全部用来交换信息即数据总线的位数：
$$
\frac{1s}{T} * 32bit
$$


也就是频率乘总位数了，结果为：
$$
20MB/s
$$
注意带宽这里的K, M表示的是10的3次方，而不是2的10次方

## 3.6

![image-20240825111701516](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240825111701516.png)

**（1）**

主存一共有：
$$
\frac{64 * 2^{10} * 8}{32}个字 = 16K字
$$
如果主存是按字编址，那么描述方式就是存储单元个数（字的个数） * 存储字长；如果是按字节编址，那就直接是多少个字节

所以这里是16K * 32bit

**（2）**

![image-20240825112615634](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240825112615634.png)

上图中方框中的是按字节编址，旁边的是按字的地址，因为主存是按字节编址，所以字的地址是字节的地址的4倍，上图是按照大端方式的结果，不过大端方式只影响字中的数据的存放方式与字或者字节的地址没有关系

**（3）**

背诵题，这里不多赘述

## 3.7

![image-20240826102052978](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240826102052978.png)

**（1）**

根据题意应该是按字编址，因此可以存储：
$$
2^{20} * 32 / 8 = 4MB
$$
**（2）**
$$
\frac{2^{20} * 32}{2^9 * 2^{10} * 8} = 8
$$
**（3）**

上述芯片中，4个芯片一组作为位扩展，两组作为字扩展，因此1位作为地址选择信号

4个芯片位扩展，扩展为一个512K * 32的芯片组

2个芯片组字扩展形成一个1M * 32位的存储器

## 3.8

![image-20240826103535675](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240826103535675.png)

简答题，这里不多赘述，这题别想复杂，并不是考SRAM的时序图，根据直觉分析即可

## 3.9

简答题

## 3.10

![image-20240826103934423](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240826103934423.png)

刷新周期与存储周期相同，因此刷新时间也是250ns，1ms中刷新64次，也就是1ms有64 * 250ns用于刷新

所以所占时间为：
$$
\frac{64 * 250ns}{1000000ns} * 100\% = 1.6\%
$$

## 3.11

![image-20240827110448774](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827110448774.png)

芯片内部的存储单元成正方形排列，一个存储单元是1位，说明一个DRAM芯片是$2^{10} * 2^{10}$的排列，说明其有$2^{10}$行

异步刷新，说明每行在一个最大刷新间隔中只刷新一次，因此每隔$\frac{4000us}{2^{10}} = 3.9us$刷新一次

4ms中一共有1024个刷新周期

注意异步刷新就是最大刷新间隔中保证每行刷新一次，至于谁先刷，怎么安排保证大家都在各自的刷新间隔中被刷新一次则是硬件电路的事情，我们这里不必考虑

**这里的刷新周期其实就是两次刷新操作相隔的时间**

## 3.12

![image-20240827111205529](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827111205529.png)

这里的8K*8K指的是内部是一个正方形的8K * 8K位组成的64M * 1位（存储容量）的存储体，但是注意这一个存储体中其实有8K行而不是64M行，只是作为存储数据的时候每一个存储体64M个位中的一个位作为总的存储体64M * 4位中的一位

所以需要刷新的行就是8K = 8 * 1024行

因此两次刷新之间的时间就是$\frac{8000 us}{8 * 1024} = 0.9us$，**注意这个时间只能取小，不能四舍五入取大**，因为如果两行刷新的时间比理论值大，那么所有行刷新的总时间就超过了最大刷新间隔，这就会造成有的行被刷新一次之后第二次刷新与第一次刷新的间隔超过了自己的最大刷新间隔，其不能被及时刷新，会造成数据丢失

所谓刷新定时信号的周期时间，也就是两行之间的时间间隔，就是0.9us

8 * 1024个刷新周期



**注意异步刷新必须保证在一个最大刷新间隔时间中每一行必须被刷新一次，如果有一行没有被刷新，那这一行保存的数据经过了这最大刷新间隔的时间数据就会丢失**

## 3.13

![image-20240827113234491](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827113234491.png)

**（1）**

芯片用量：$\frac{64K * 32}{16K * 8} = 16$个

**（2）**

画这种DRAM扩展的逻辑示意图的流程：

（1）先画出所有的芯片，本题中一共有4 * 4个芯片，引出所有的数据位D0~D32

（2）画出两个控制器件，一个是地址多路选择器，一个是片选译码器

（3）对于地址多路选择器（三选一），因为DRAM是多路地址复用的，这里一组有16K的地址，所以应该有14位的地址，复用一下就是7位，所以行地址7位，列地址7位，并且还需要提供刷新地址，而一组有128行的存储单元，所以刷新地址也是七位

（4）对于片选译码器，这里有四组，因此输出就是4个片选信号，输入就是2位地址，所以这是一个2-4译码器，片选译码器的输入包含三个部分，最高的几位地址形成片选信号，行选通信号RAS，以及刷新信号，DRAM芯片组中的片使能信号与行选通信号结合了，在本题中有四组芯片，所以形成的片选信号（行选通信号就是4个）

（5）然后是一些细节收尾，列选通信号CAS和读写控制信号WE，这两个信号单独引出

（6）最后是芯片的连线，芯片之间的连线表示这条线上的数据都是一样的，连线分支表示总线上和分支上的数据都是一样的，对于地址分配，首先是最高的几位地址作为片选信号，然后是列地址，然后是行地址，刷新地址与行地址的位数一样，最后就是不用在意低电平还是高电平有效（圈圈不用画出来），箭头表示信号传递方向，地址线的宽度要宽一些

因此画出来的结果如下所示：

![image-20240827162002081](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827162002081.png)



**（3）**

注意分析芯片中存储的行列的时候，有以下几点：

1. 芯片中是一个正方形的存储单元矩阵，一个存储单元可以包含1个或者8的倍数个存储元（1位）
2. 所以对于64K * 8的芯片其就是一个$2^{8} * 2^{8}$的存储矩阵，这个矩阵中一个存储单元就是8位，对于题中的$128 * 128 * 8$的意思就是存储矩阵是128 * 128 但是一个存储单元是8位
3. 一组是4个这样的芯片进行位扩展，四组进行字扩展，所以这个存储体的总的行就是4 * 128 = 512行

但是注意刷新都是按照芯片进行的，所以刷新的行其实是128行，因此刷新周期就是：
$$
\frac{8000us}{128} = 62.5us
$$
当一个芯片刷新完成之后也就代表整个存储体的刷新就完成了，所以有128个刷新周期

**（4）**

这里还是以一个128行的芯片作为对象分析

分散式刷新是指将刷新分散到存取周期中，即存取周期的前半段存取，后半段刷新，因此这里的存取周期变成了1us，所以8ms中一共有$\frac{8ms}{1us} = 8000次$刷新

评均下来一行刷新了$\frac{8000}{128} = 62.5次$，比异步式刷新多刷新了61.5次

**（5）**

集中式刷新是在一个最大刷新间隔的末尾统一刷新所有的行，**刷新一行需要一个存取周期**，所以死时间就是128 * 0.5us = 64us

## 3.14

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827190444742.png" alt="image-20240827190444742" style="zoom:67%;" />

**（1）**

地址空间分配方案如下所示

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827192319797.png" alt="image-20240827192319797" style="zoom:67%;" />

**所谓译码方案，就是16根地址线多少根作为片选地址，多少根作为片内地址**所以我们需要知道ROM和RAM各用了多少片

ROM的数量为：
$$
\frac{16K * 16}{8K * 8} = 4片
$$
两片为一组进行位扩展，两组作为字扩展

RAM的数量为：
$$
\frac{40K * 16}{8K * 8} = 10片
$$
2片为一组进行位扩展，5组作为字扩展，所以在图中表示出来就是：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827192727566.png" alt="image-20240827192727566" style="zoom:67%;" />

因此片内地址应该是8K，也就是需要13根地址线，而片选负责每个组，也就是7组，需要3根地址线即可，所以根上述每组分配的片选信号如下所示，注意RAM的地址从0110 0000 0000 0000开始，所以RAM区域对应的地址其最高三位必然大于等于3，因此3-8译码给其分配的是后5个信号，而不是从2开始的连续五个信号（从二开始的信号对应的最高三位地址线是010但是RAM不可能出现这样的地址）：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827192901575.png" alt="image-20240827192901575" style="zoom:67%;" />

**（2）**

画出SRAM和ROM的过程一般如下：

1. 将所需要的ROM和RAM摆好之后引出数据线连接到CPU，数据线8位一组，连到CPU

2. 画出译码器，分别将输出连到对应的片组，这里是将3-8译码器的7个输出连到对应的片组
   1. 译码器的输入有两个部分，一个是控制信号G2A, G2B, G1，以及地址信号（本例中是2个最高位地址），输出就是8个片选信号，这里只用了7个

3. 画出CPU，CPU包含四个部分：
   1. 数据部分，这里是16位的数据，每8位一组
   2. 片内地址部分，这里是0 ~ 12编号的地址线
   3. 片选部分，这里是13 ~ 15编号的地址线
   4. 访存控制信号MREQ和读写控制信号
4. 连线
   1. 数据线连到CPU的数据部分
   2. 片内地址从CPU引出来连到对应的片组
   3. 片选地址连到译码器，这里是最高三个地址线连到3-8译码器
   4. 访存控制信号连到译码器的控制段信号G2A和G2B，读写控制信号连到RAM
   5. 译码器的G1连到电源
   6. 最后连上片选信号即可
   7. 注意那些控制信号都是低电平有效，写出名字的时候加上一个横线即可

画图如下所示：

![image-20240827200540574](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827200540574.png)

或者采用横着摆放每一组，位扩展竖着摆放：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240827195837807.png" alt="image-20240827195837807" style="zoom:67%;" />

第二种摆放的时候片内地址作为一个分支分别连到一组中的两个芯片，表示这一组被片选信号选中之后这两个芯片接收同样的13位地址，读取的数据分别作为16位数据的低八位和高八位
