# 第四章 - 总线与输入/输出系统

## 字符显示器的各个部件原理

字符显示器的结构如下所示：

![image-20240912180828101](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240912180828101.png)

首先是在屏幕上显示字符，字符显示器采用点阵法显示字符，即一个字符其实是由M * N行的屏幕上的点阵构成，比如一个字符A是由7 * 9的字符构成：

<img src="https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240912181115560.png" alt="image-20240912181115560" style="zoom:67%;" />

字符显示器通过控制电子束一行行扫描这个字符所占据的点阵，然后在对应的行的上图深色位置标记，这样就可以在屏幕上显示字符了

屏幕上的字符所占的行和列的点阵以及字符之间的间隔合在一起称为字符窗口

### **显示存储器VRAM**

VRAM用来存放整个屏幕的字符信息，因此其大小与屏幕的字符个数相对应，通常西文字符以ASCII码的形式存放在VRAM中，因此VRAM中的一个存储单元的最小宽度是一个字节

VRAM中的每个单元的地址是由屏幕上字符的行和列决定的，即VRAM的地址为字符所在的行号 * 一行的字符个数 + 字符所在的列号

这里的行号和列号都是字符的行号和列号不是像素点的行号和列号

其容量以及字符的地址举例如下所示：

![image-20240912183435926](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240912183435926.png)

### **字符发生器ROM**

字符发生器的作用就是将VRAM中的字符编码（ASCII码）转化成二进制信息（也就是对应点阵信息，下文细嗦）存放到ROM中，然后显示的时候就根据这些二进制的编码（点阵信息）逐行扫描在屏幕上显示对应的字符

对于字符发生器的容量，其取决于整个字符集的大小和点阵规模，一个点阵就表示二进制的一个位存放到发生器ROM中，比如：

![image-20240912183818837](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240912183818837.png)

字符间隙是一个像素点，那么一个字符所占据的点阵的一行就不是7位，而是8位，也就是一个字节，注意这里像素点阵的7 * 8是7列8行 即 列*行，而不是一般的程序语言中的行 * 列

对于字符发生器ROM中一个字符的起始地址，其由两部分构成，高地址部分来自VRAM中这个字符的ASCII码，低地址部分为这个字符在整个字符点阵窗口中的行号（**注意不是整个屏幕行号，而是字符窗口点阵中的行号**），因为行计数器的值作为ROM中一个字符的低位地址，而行计数器的模是字符窗口的高度，至于怎么确定字符在屏幕中的位置，推测是根据VRAM地址进行的

比如字符‘A’，其ASCII为41H，并且其在字符点阵中所在的行号又是0，所以其在ROM中的地址就是410H

字符A在字符点阵中所占据的是7列 * 9行，加上列间隔，其应该是8列 * 9行，如果再加上行间隔则应该是8列 * 11行

但是ROM中不存放行间隔，因此字符A所占据的点阵实际存放在ROM中应该是8列 * 9行，其显示在屏幕上的点阵如下所示：

![image-20240912184458847](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240912184458847.png)

这8列 * 9行点阵每一个点表示一个二进制，深色就是1，白色是0，8列*9行点阵可以看作9个连续的字节数，按照行的顺序从上到下是10H，28H, 44H, 82H, 82H, FEH, 82H, 82H, 82H

因此这个字符A存放在ROM中的规律就是起始地址为410H，然后连续9个字节分别存放上面的9个字节数

接着字符显示器的其他部分将这些字节数取出来分别按照这些二进制的1和0来控制亮度，控制电子束，这样就可以在屏幕的对应位置显示A了

当然这里应该是先有ROM中的存放方式，再有屏幕上的点阵显示，这里我们为了方便理解用屏幕点阵来说明，至于ROM中的存放方式其实是事先控制的，肯定是先控制，再显示

### **显示定时控制系统**

显示定时控制主要提供屏幕刷新过程中的定时信号，其包括点振荡器等几个计数器，这个系统的作用是确保电子束或像素点能够以正确的方式在显示屏上进行扫描，从而准确地生成和显示图像

其控制的基本电路如下所示：

![image-20240914181350557](https://typora-1310242472.cos.ap-nanjing.myqcloud.com/typora_img/image-20240914181350557.png)

这个电路可以不用掌握，知道几个计数器的大概位置和作用即可

**点振荡器**

作用是生成一个稳定的时钟信号，用于控制屏幕上的电子束扫描，因此其频率和帧频率和分辨率有关系

分辨率一定，帧频率越高，那就说明电子束的扫描就得加快；同样帧频率一定但是分辨率越高，那一行的电子需要打点就越多，电子书的扫面也得加快即点频率越高

**点计数器**

点计数器的作用是跟踪和管理电子束或像素点的当前位置，从而确保图像的正确显示，**点计数器加一表示电子束扫描了一个像素点点**

点计数器的模等于字符窗口的宽度，其每记满一次就输出一个字符时钟信号，表示一个字符结束，控制移位寄存器对字符的加载

> 这里的模指的是计数器可以计数的最大数加一，也就是计数器的大小，比如窗口大小是9，模就是9，那计数器可以计数的范围就是0 ~ 8

**点计数器的输出表示电子束扫描了一个字符宽度的像素点**



**字计数器（水平地址计数器）**

字计数器的作用是对屏幕中的一行的字符进行计数，**字计数器加一表示电子束扫描了一个字符宽度的像素点**

对于VRAM显存来说里面的字符地址为字符所在的行号 * 一行的字符个数 + 字符所在的列号

所以字计数器的计数值就可以当作这个字符在VRAM中的地址的低位（相当于第几行的第几列，类似于Cache地址中块中的第几个字节这样的意义）

字计数器的模等于屏幕一行所显示的字数加上水平回扫的时间（一般计算的时候就用一行的字符周期的个数）；字计数器每记满一次就输出一个行时钟信号，表示一行的点（像素）结束

**字计数器的输出表示电子束扫描了一行的像素点**



**行计数器（光栅地址计数器）**

行计数器的作用是对字符窗口中的像素行进行计数，**行计数器加一表示电子束扫描了一行的像素点**

它的计数脉冲来自于字计数器，根据上文所述字计数器输出一个信号就表示一行，此时的行计数器就加一

字符发生器ROM中字符的地址的低位就是字符在字符窗口阵列中的行号，所以行计数器的值就送往ROM作为低位地址

行计数器的模等于字符窗口的高度，其每记满一次就输出一个排时钟信号，表示一排的字符结束（就是一行的字符）

**行计数器输出表示电子束扫描了一行的字符**



**排计数器（垂直地址计数器）**

排计数器的作用是统计屏幕的字符行，**排计数器加一表示电子束扫描了一行的字符**

它的计数脉冲来自于行计数器输出的排时钟信号

上文中对于VRAM显存来说里面的字符地址为字符所在的行号 * 一行的字符个数 + 字符所在的列号

因此排计数器的值就可以作用于当前字符在VRAM的高位地址

排计数器的模是屏幕所显示的字符行数加上垂直回扫的时间（一般计算的时候就用整个屏幕字符行周期的个数），**其记满一次表示电子束扫描完整个屏幕的字符**，这时就控制进行垂直回扫

